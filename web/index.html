<html>
<head>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script>
        $(() => {
            const conn = new WebSocket('ws://localhost:8081?u=1');
            conn.onopen = function () {
                const url = new URL(window.location.href);
                const u = url.searchParams.get('u');
                conn.send(JSON.stringify({ action: 'authenticate', value: u || 0 }));
            };

            conn.onmessage = function (e) {
                const json = JSON.parse(e.data);
                switch (json.action) {
                    case 'authenticate':
                        break;
                    case 'message':
                        $('#messages-list').append($('<div>').html(json.value));
                        break;
                }
            };

            $('#button').click(() => {
                conn.send(JSON.stringify({ action: 'message', value: 'Hello World!' }));
            });
        });
    </script>
</head>
<body>
    <div id="messages-list">

    </div>
    <input id="input">
    <button id="button"></button>
</body>
</html>
